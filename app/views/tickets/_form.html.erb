<table><tr><td class="formulario">
<%= form_for(@ticket) do |f| %>
  <%= render "shared/error_messages", :target => @ticket, :text => "el Ticket" %>  

  <table class="display">
  <% if not @ticket.id.nil? %> 
      <tr><td>Ticket N°:</td><td class="ro"><div class="sh"><%= @ticket.id %></div></td>
  <% else %>
      <tr><td></td><td></td>   
  <% end %>
  <th rowspan=3 width=16></th>

  <% if not @caso.nil? %> 
    <%= f.hidden_field :principal_id, :value => @caso.principal_id  %>
    <%= f.hidden_field :product_id, :value => @caso.product_id  %>
    <td>Rut:</td><td class="ro"><%= f.text_field :rut, :size => "10", :value => @caso.rut, :readonly => true %> - <%= f.text_field :digit, :size => "1", :value => @caso.digit, :readonly => true %></td>
  </tr>
  <tr>
    <td width="130">Identificador:</td><td class="ro" width="70"><%= f.text_field :cas_id, :size => "16", :value => @caso.cas_id, :readonly => true %></td>
    <td width="110">Nombre:</td><td><%= f.text_field :name, :size => "37", :value => @caso.name %></td>
  </tr>
  <tr>
    <td>Tipo de Cobranza:</td><td class="ro"><%= f.text_field :collection_type_name, :size => "16", :value => @caso.collection_type.name, :readonly => true %></td>
    <td>Mandante:</td><td class="ro"><%= f.text_field :principal_name, :size => "37", :value => @caso.principal.name, :readonly => true %></td>
  </tr>
  <tr>
    <td>Descripción del Pago:</td><td colspan="4"><%= f.text_area :payment_description, :size => "61x2" %></td>
  </tr>
  <tr>
    <td>Capital:</td><td><%= f.text_field :capital, :size => "8", :value => @caso.capital %></td>
    <th rowspan=7 width=16></th>
    <td>Producto:</td><td class="ro"><%= f.text_field :product_name, :size => "37", :value => @caso.product.name, :readonly => true %></td>
  </tr>
  <tr>
    <td>Interés Mora:</td><td class="ro"><%= f.text_field :arrear_interest, :size => "8", :value => @arr, :readonly => true %></td>
    <td>Número:</td><td><%= f.text_field :number, :size => "37", :value => @caso.number %></td>
  </tr>
  <tr>
    <td>Interés Plazo:</td><td class="ro"><%= f.text_field :term_interest, :size => "8", :value => @term, :readonly => true %></td>
    <td>Emisor:</td><td><%= f.text_field :emitter, :size => "37", :value => @caso.emitter %></td>
  </tr>
  <tr>
    <td>Honorarios:</td><td class="ro"><%= f.text_field :fee, :size => "8", :value => @fee, :readonly => true %></td>
    <td>Cuenta Corriente:</td><td><%= f.text_field :ctacte, :size => "37", :value => @caso.ctacte %></td>
  </tr>
  <tr>
    <td>Gastos Envío:</td><td><%= f.text_field :shipping_costs, :size => "8" %></td>
    <td>Vencimiento:</td><td><%= f.text_field :expir_date, :size => "37", :value => @caso.expir_date.strftime("%d-%b-%Y") %></td>
  </tr>
  <tr>
    <td>Gastos Judiciales:</td><td><%= f.text_field :legal_costs, :size => "8" %></td>
    <td>Boleta N°: </td><td><%= f.text_field :ballot, :size => "37" %></td>
  </tr>
  <tr>
    <td>Total a Pagar:</td><td><%= f.text_field :total_pay, :size => "8", :value => @total %></td>
    <td>Cuota:</td><td><%= f.text_field :quota_num, :size => "2" %> de <%= f.text_field :total_q, :size => "3" %></td>
  </tr>
  <tr><td height="20"></td></tr>
  <tr>
    <td>Preparado por:</td><td colspan=4><%= f.select(:user_id, User.find(:all, :conditions => {:state => true, :profile_id => current_user.profile_id}, :order => 'name').collect {|u| [u.name, u.id]}, {:selected => @user_id}) %></td>
  </tr>
  <tr>
    <td colspan=3>Entrega documento a deudor:</td><td><%= f.check_box :doc_delivery %> Sí</td>
  </tr>
  <tr><td height="20"></td></tr>
  <tr>
    <td colspan=3>Solicita modificación a Supervisor:</td><td><%= f.check_box :adjust_sup %> Sí</td>
  </tr>
  <tr>
    <td>Descripción de la modificación solicitada:</td><td colspan="4"><%= f.text_area :adjust_sup_des, :size => "61x2" %></td>
  </tr>

  <% else %>
    <td>Rut:</td><td><%= f.text_field :rut, :size => "10"%> - <%= f.text_field :digit, :size => "1"%></td>
  </tr>
  <tr>
    <td>Identificador:</td><td><%= f.text_field :cas_id, :size => "12"%></td>
    <td>Nombre:</td><td><%= f.text_field :name, :size => "37"%></td>
  </tr>
  <tr>
    <td width="130">Tipo de Cobranza:</td><td width="70"><%= f.collection_select :collection_type_id, CollectionType.find(:all, :conditions => {:state => true}, :order => 'name'), :id, :name %></td>
    <td width="110">Mandante:</td><td><%= f.collection_select :principal_id, Principal.find(:all, :conditions => {:state => true}, :order => 'name'), :id, :name %></td>
  </tr>
  <tr>
    <td>Descripción del Pago:</td><td colspan="4"><%= f.text_area :payment_description, :size => "61x2" %></td>
  </tr>
  <tr>
    <td>Capital:</td><td><%= f.text_field :capital, :size => "8" %></td>
    <th rowspan=7 width=16></th>
    <td>Producto:</td><td><%= f.collection_select :product_id, Product.find(:all, :conditions => {:state => true}, :order => 'name'), :id, :name %></td>
  </tr>
  <% if current_user.profile_id==1 %> 
  <tr>
    <td>Interés Mora:</td><td class="ro"><%= f.text_field :arrear_interest, :size => "8", :readonly => true %></td>
    <td>Número:</td><td><%= f.text_field :number, :size => "37" %></td>
  </tr>
  <tr>
    <td>Interés Plazo:</td><td class="ro"><%= f.text_field :term_interest, :size => "8", :readonly => true%></td>
    <td>Emisor:</td><td><%= f.text_field :emitter, :size => "37" %></td>
  </tr>
  <tr>
    <td>Honorarios:</td><td class="ro"><%= f.text_field :fee, :size => "8", :readonly => true%></td>
    <td>Cuenta Corriente:</td><td><%= f.text_field :ctacte, :size => "37"%></td>
  </tr>
  <% elsif current_user.profile_id==2 %> 
  <tr>
    <td>Interés Mora:</td><td><%= f.text_field :arrear_interest, :size => "8"%></td>
    <td>Número:</td><td><%= f.text_field :number, :size => "37" %></td>
  </tr>
  <tr>
    <td>Interés Plazo:</td><td><%= f.text_field :term_interest, :size => "8"%></td>
    <td>Emisor:</td><td><%= f.text_field :emitter, :size => "37" %></td>
  </tr>
  <tr>
    <td>Honorarios:</td><td><%= f.text_field :fee, :size => "8"%></td>
    <td>Cuenta Corriente:</td><td><%= f.text_field :ctacte, :size => "37"%></td>
  </tr>
  <% end %> 
  <tr>
    <td>Gastos Envío:</td><td><%= f.text_field :shipping_costs, :size => "8" %></td>
    <td>Vencimiento:</td><td><%= f.date_select :expir_date, :order => [:day, :month, :year] %></td>
  </tr>
  <tr>
    <td>Gastos Judiciales:</td><td><%= f.text_field :legal_costs, :size => "8" %></td>
    <td>Boleta N°: </td><td><%= f.text_field :ballot, :size => "37" %></td>
  </tr>
  <tr>
    <td>Total a Pagar:</td><td><%= f.text_field :total_pay, :size => "8", :value => @total %></td>
    <td>Cuota:</td><td><%= f.text_field :quota_num, :size => "2" %> de <%= f.text_field :total_q, :size => "3" %></td>
  </tr>
  <% if current_user.profile_id==2 %> 
  <tr>
    <td>Ajuste:</td><td><%= f.text_field :adjust , :size => "8"%></td>
    <th rowspan="3" width=16></th>
    <td rowspan="2">Observación ajuste:</td><td rowspan="2"><%= f.text_area :adjust , :size => "28x2"%></td>
  </tr>
  <tr>
    <td>Nuevo Total a Pagar:</td><td><%= f.text_field :new_total_pay , :size => "8"%></td>
    <td></td>
  </tr>
  <tr>
    <td>Fecha ajuste:</td><td class="ro"><%= f.text_field :adjust_time , :size => "13", :value => Time.now.strftime("%d-%b-%Y"), :readonly => "true" %></td>
    <td>Ajustado por:</td><td class="ro"><%= f.text_field :adjust_by , :size => "37", :value => current_user.name, :readonly => "true" %></td>
  </tr>
  <% end %>
  <tr><td height="20"></td></tr>
  <tr>
  <% if @ticket.id.nil? %> 
    <td>Preparado por:</td><td colspan=4><%= f.select(:user_id, User.find(:all, :conditions => {:state => true, :profile_id => current_user.profile_id}, :order => 'name').collect {|u| [u.name, u.id]}, {:selected => @user_id}) %></td>
  <% else %>
    <td>Preparado por:</td><td colspan=4 class="ro"><div class="lg"><%= @ticket.prepared_by %></div></td>
  <% end %>
  </tr>
  <tr>
    <td colspan=3>Entrega documento a deudor:</td><td><%= f.check_box :doc_delivery %> Sí</td>
  </tr>
  <tr><td height="20"></td></tr>
  <!-------  Modificacion de supervisor ------->
  <% if current_user.profile_id==1 %> <!-- Eje Cobranza -->
    <tr>
      <td colspan=3>Solicita modificación a Supervisor:</td><td><%= f.check_box :adjust_sup %> Sí</td>
    </tr>
    <tr>
      <td>Descripción de la modificación solicitada:</td><td colspan="4"><%= f.text_area :adjust_sup_des, :size => "61x2" %></td>
    </tr>
  <% end %>
  <% if @ticket.adjust_sup_time %>
    <tr>
      <td>Fecha solicitud:</td><td class="ro"><div class="sh"><%= @ticket.adjust_sup_time.strftime("%d-%b-%Y") %></div></td><td></td>
      <td>Hora solicitud:</td><td class="ro"><div class="sh"><%= @ticket.adjust_sup_time.strftime("%H:%M") %> hrs.</div></td>
    </tr>
  <% end %>
  <!-------  Fin Modificacion de supervisor ------->
  <!-------  Modificacion de Gerencia ------->
  <% if current_user.profile_id==2 %> <!-- Supervisor -->
    <tr>
      <td colspan=3>Solicita modificación a Gerencia:</td><td><%= f.check_box :adjust_mgt %> Sí</td>
    </tr>
    <tr>
      <td>Descripción de la modificación solicitada:</td><td colspan="4"><%= f.text_area :adjust_mgt_des, :size => "61x2" %></td>
    </tr>
    <% if @ticket.adjust_mgt_time %>
      <tr>
        <td>Fecha solicitud:</td><td class="ro"><div class="sh"><%= @ticket.adjust_mgt_time.strftime("%d-%b-%Y") %></div></td><td></td>
        <td>Hora solicitud:</td><td class="ro"><div class="sh"><%= @ticket.adjust_mgt_time.strftime("%H:%M") %> hrs.</div></td>
      </tr>
    <% end %>
  <% end %>
  <!-------  Fin Modificacion de Gerencia ------->
  <% end %>
  </table>

  <div class="actions">
  <% if current_user.profile_id==2 and @ticket.state=='pms' %> <!-- Por modificar Supervisor -->
    <%= f.submit "Modificar Ticket"%>
  <% else %>
    <%= f.submit "Grabar"%>
  <% end %>
  </div>  

<% end %>
</td></tr></table>

  <%= render "hiddenvar" %>  

